<!DOCTYPE html>
<head>
    <meta charset=UTF8>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Calculadora2</title>
    <style>
        .containerCalcu {
            float: left;
            background-color: black;
            padding: 18px;
            border-radius: 4px;
            width: 210px;
            box-sizing: border-box;
        }

        .containerPapel {
          float: left;
          background-color: rgba(216, 214, 207, 0.918);
          width: 50%;
          padding: 18px;
          box-sizing: border-box;
        }

        input {
            width: 165px;
            height: 25px;
            border-width: 3px;
            margin: 0px 0px 8px 0px;
            text-align: right;
        }
        button {
            width: 40px;
            height: 40px;
            border-radius: 4px;
            margin: 0px 0px 4px 0px;
            color: rgb(189, 188, 188);
            background-color: rgb(70, 38, 38);
            text-align: center;
        }
        .numero {
            color: white;
            background-color: rgb(34, 21, 21);
        }
    </style>
</head>

<body>
    <h2>Pimera versi√≥n de la calculadora</h2>
    <div class="containerCalcu">
        <input type="text" name="display" id="display" minlength="4" maxlength="8" size="10" required >
        <br/>
        <button name="borrar" id="borrar" onclick="borrar()">AC</button>
        <button name="del" id="del" onclick="del()">Del</button>
        <br/>
        <button class="numero" name="siete" id="siete" onclick="clickBoton(7)">7</button>
        <button class="numero"name="ocho" id="ocho" onclick="clickBoton(8)">8</button>
        <button class="numero"name="nueve" id="nueve" onclick="clickBoton(9)">9</button>
        <button name="division" id="division" onclick="clickOperador('/')">/</button>
        <br/>
        <button class="numero"name="cuatro" id="cuatro" onclick="clickBoton(4)">4</button>
        <button class="numero"name="cinco" id="cinco" onclick="clickBoton(5)">5</button>
        <button class="numero"name="seis" id="seis" onclick="clickBoton(6)">6</button>
        <button name="multiplicacion" id="multiplicacion" onclick="clickOperador('*')">*</button>
        <br/>
        <button class="numero"name="uno" id="uno" onclick="clickBoton(1)">1</button>
        <button class="numero"name="dos" id="dos" onclick="clickBoton(2)">2</button>
        <button class="numero"name="tres" id="tres" onclick="clickBoton(3)">3</button>
        <button name="menos" id="menos" onclick="clickOperador('-')">-</button>
        <br/>
        <button class="operador"name="punto" id="punto"  onclick="clickBoton('.')">.</button>
        <button class="numero"name="cero" id="cero" onclick="clickBoton(0)">0</button>
        <button name="igual" id="igual" onclick="resultado()">=</button>
        <button name="mas" id="mas" onclick="clickOperador('+')">+</button>
    </div>

    <div class="containerPapel" id="containerPapel">

    </div>
</body>
<!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-database.js"></script>

<!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->

<script>
  // Your web app's Firebase configuration
  var firebaseConfig = {
    apiKey: "AIzaSyA8mFJP6XWhxYC5b_wSwsMbYQck_wHWjDo",
    authDomain: "calculadora-c6d1f.firebaseapp.com",
    projectId: "calculadora-c6d1f",
    storageBucket: "calculadora-c6d1f.appspot.com",
    messagingSenderId: "882449623031",
    appId: "1:882449623031:web:b01a6b398304004c9330f2"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
</script>

<script>

    //var tiraPapel;

    var database = firebase.database();

    function escribirDatos(usuario, input, resultado) {
        console.log('escribiendo');
        id = Date.now();
        const databaseRef = firebase.database().ref();
        databaseRef.child(usuario).child(id).set({
        input: input,
        resultado: resultado,
    });
        return id;
    }

    function readUserData (usuario) {
        const databaseRefChild = database.ref().child(usuario);
        databaseRefChild.get().then(function(snapshot) {
            if (snapshot.exists()) {
                datos = snapshot.val();
                console.log(datos);
                imprimirPapel(datos);
                }
            else {
                console.log("No data available");
                }
            }).catch(function(error) {
                console.error(error);
            });
        }

    function clickOperador (boton) {
      const operadores = ['+', '-', '*', '/'];
      let input = document.getElementById("display").value;
      if (operadores.indexOf(input.slice(-1,)) != -1) {
        console.log(input);
        document.getElementById("display").value = input.slice(0, -1);
        }
      clickBoton(boton);
    }

    function resultado() {
      let input = document.getElementById("display").value;
      let resultado = eval(input);
      document.getElementById("display").value = resultado;
      escribirDatos('gaston', input, resultado);
      readUserData('gaston');
      //console.log(tiraPapel);
      //archivo(input, resultado);
      //imprimirPapel(datos);
     }
    
    function clickBoton(boton) {
      let input = document.getElementById("display").value;
      document.getElementById("display").value += boton;
    }

    function borrar() {
      document.getElementById("display").value = "";
    }

    function del(){
      let input = document.getElementById("display").value; 
      document.getElementById("display").value = input.slice(0, -1);
    }

    function archivo(input, resultado) {
      if (resultado != undefined) {
        tiraPapel.push(input + ' = ' + resultado);
                  }
      if (tiraPapel.length > 10) {
        tiraPapel = borrarPrimerElemento(tiraPapel);
                  }
      }
    
    function borrarPrimerElemento(elementos) {
      elementos.shift();
      console.log(elementos);
      return elementos
    }

    function imprimirPapel(datos) {
        codigo = bloqueCodigo(datos);
        console.log(codigo);
        document.getElementById("containerPapel").innerHTML = codigo;
    }      

    function bloqueCodigo (snapshot) {
        console.log(snapshot)
        var codigo = '';
        for (let id in snapshot) {
            console.log(snapshot[id]['input'], snapshot[id]['resultado']);
            var linea = `<p id="posicion_${id}">${snapshot[id]['input']} = ${snapshot[id]['resultado']}</p>`;
            codigo += linea;
        }
        return codigo
    }
</script>

</html>